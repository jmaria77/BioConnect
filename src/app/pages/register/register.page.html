<ion-header translucent="true">
  <ion-toolbar color="light">
    <ion-title class="title">Registro de Usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding register-page">
  <div class="register-container animate__animated animate__fadeIn">
    <ion-card class="register-card">
      <ion-card-header class="ion-text-center">
        <ion-card-title>Crear Cuenta</ion-card-title>
        <ion-card-subtitle>
          Registra tu información y configura tu acceso facial
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <form (ngSubmit)="onRegister()" #registerForm="ngForm">

          <!-- Nombre de usuario -->
          <ion-item lines="full">
            <ion-label position="floating">Nombre de Usuario</ion-label>
            <ion-input
              type="text"
              [(ngModel)]="userData.username"
              name="username"
              required
              clearInput
              placeholder="Ej: jlopez23">
            </ion-input>
          </ion-item>

          <!-- Rol -->
          <ion-item lines="full">
            <ion-label position="floating">Rol</ion-label>
            <ion-select
              interface="alert"
              placeholder="Selecciona tu rol"
              [(ngModel)]="userData.role"
              name="role"
              required>
              <ion-select-option value="trabajador">Trabajador</ion-select-option>
              <ion-select-option value="encargado">Encargado</ion-select-option>
            </ion-select>
          </ion-item>

          <!-- Biometría -->
          <div class="biometric-section ion-margin-top">
            <ion-item lines="none">
              <ion-icon name="face-outline" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h3>Reconocimiento Facial</h3>
                <p>Configura tu autenticación biométrica</p>
              </ion-label>
              <ion-button
                fill="solid"
                color="success"
                (click)="captureBiometric()"
                [disabled]="isCapturing"
                size="small">
                <ion-spinner *ngIf="isCapturing" name="crescent"></ion-spinner>
                <span *ngIf="!isCapturing">{{ biometricCaptured ? 'Recapturar' : 'Capturar' }}</span>
              </ion-button>
            </ion-item>

            <ion-item lines="none">
              <ion-icon name="camera-outline" slot="start" color="secondary"></ion-icon>
              <ion-label>
                <h3>Prueba de Cámara</h3>
                <p>Verifica que la cámara funcione correctamente</p>
              </ion-label>
              <ion-button
                fill="outline"
                color="medium"
                (click)="testCamera()"
                size="small">
                Probar
              </ion-button>
            </ion-item>

            <ion-item *ngIf="biometricCaptured" lines="none" class="ion-margin-top">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>
                <h3>Biometría Configurada</h3>
                <p>Reconocimiento facial listo</p>
              </ion-label>
            </ion-item>
          </div>

          <!-- Botón de registro -->
          <ion-button
            expand="block"
            type="submit"
            color="primary"
            [disabled]="!registerForm.valid || !biometricCaptured || isRegistering"
            class="ion-margin-top register-btn">
            <ion-spinner *ngIf="isRegistering" name="crescent"></ion-spinner>
            <span *ngIf="!isRegistering">Registrar</span>
          </ion-button>

          <!-- Enlace login -->
          <div class="ion-text-center ion-margin-top">
            <ion-text color="medium">
              ¿Ya tienes cuenta?
            </ion-text>
            <ion-button fill="clear" size="small" routerLink="/login">
              Inicia sesión
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>

    <!-- Estado offline -->
    <ion-card *ngIf="!isOnline" color="warning" class="offline-card">
      <ion-item lines="none">
        <ion-icon name="cloud-offline" slot="start"></ion-icon>
        <ion-label>
          <h3>Modo Offline</h3>
          <p>Los datos se sincronizarán cuando haya conexión</p>
        </ion-label>
      </ion-item>
    </ion-card>
  </div>
</ion-content>
